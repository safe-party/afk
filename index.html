<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>MCQ Quiz</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #question { font-weight: bold; margin-bottom: 10px; }
    .option { display: block; margin: 5px 0; }
    #explanation { margin-top: 10px; padding: 10px; background: #f0f0f0; display:none; }
    #navigation { margin-top: 20px; }
  </style>
</head>
<body>
  <div id="quiz">
    <div id="question">Loading...</div>
    <form id="options"></form>
    <button id="check">Check Answer</button>
    <div id="explanation"></div>
    <div id="navigation">
      <button id="prev">Previous</button>
      <button id="next">Next</button>
    </div>
  </div>

  <script>
  const mdFile = 'combined%20qs.md';
  let questions = [];
  let current = 0;

  function parseQuestions(md) {
    const blocks = md.split(/\n---\n/);
    const qs = [];
    for (const block of blocks) {
      const lines = block.trim().split(/\n/);
      let i = 0;
      while (i < lines.length && !lines[i].startsWith('###')) i++;
      if (i >= lines.length) continue;
      i++; // skip "### Question" line
      let qText = '';
      for (; i < lines.length; i++) {
        const l = lines[i].trim();
        if (/^[A-Z]\./.test(l) || /^\*\*[A-Z]\./.test(l)) break;
        qText += (qText ? ' ' : '') + l;
      }
      const opts = [];
      let answer = -1;
      for (; i < lines.length; i++) {
        let l = lines[i].trim();
        if (l === '') continue;
        if (l.startsWith('**Explanation')) break;
        let correct = false;
        if (l.startsWith('**')) { correct = true; l = l.slice(2); }
        if (l.endsWith('**')) l = l.slice(0, -2);
        opts.push(l);
        if (correct) answer = opts.length - 1;
      }
      while (i < lines.length && !lines[i].startsWith('**Explanation')) i++;
      i++;
      const explanation = lines.slice(i).join('\n').trim();
      if (qText && opts.length) qs.push({question:qText, options:opts, answer, explanation});
    }
    return qs;
  }

  function showQuestion(idx) {
    const q = questions[idx];
    document.getElementById('question').textContent = 'Question ' + (idx+1) + ': ' + q.question;
    const form = document.getElementById('options');
    form.innerHTML = '';
    q.options.forEach((opt, i) => {
      const label = document.createElement('label');
      label.className = 'option';
      const input = document.createElement('input');
      input.type = 'radio';
      input.name = 'option';
      input.value = i;
      label.appendChild(input);
      label.appendChild(document.createTextNode(' ' + opt));
      form.appendChild(label);
    });
    document.getElementById('explanation').style.display = 'none';
  }

  document.getElementById('check').addEventListener('click', function(e){
    e.preventDefault();
    const selected = document.querySelector('input[name=option]:checked');
    if (!selected) { alert('Please select an answer.'); return; }
    const idx = parseInt(selected.value);
    const q = questions[current];
    const result = idx === q.answer ? 'Correct!' : 'Incorrect!';
    const exp = document.getElementById('explanation');
    exp.innerHTML = '<strong>' + result + '</strong><br>' + q.explanation;
    exp.style.display = 'block';
  });

  document.getElementById('next').addEventListener('click', function(){
    if (current < questions.length -1) { current++; showQuestion(current); }
  });
  document.getElementById('prev').addEventListener('click', function(){
    if (current > 0) { current--; showQuestion(current); }
  });

  fetch(mdFile)
    .then(r => r.text())
    .then(t => { questions = parseQuestions(t); showQuestion(0); })
    .catch(err => { document.getElementById('question').textContent = 'Failed to load questions.'; });
  </script>
</body>
</html>
